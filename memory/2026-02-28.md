# 2026-02-28

## Daily Workflow Upgrade: News Feed Image Generation Fix ✅

**Project:** News-feed image generation reliability improvement

**Problem Identified:**
- `news-feed/generate-image.sh` had hardcoded incorrect path to Nano Banana Pro script
- Path was `/home/phan_harry/openclaw/...` instead of `/home/phan_harry/.npm-global/lib/node_modules/openclaw/...`
- Script was failing silently due to missing dependency validation
- Odd file permissions (rwx--x--x) suggested previous issues

**Changes Made:**
1. Fixed script path to correct OpenClaw global modules location
2. Added dependency validation checks:
   - Nano Banana Pro script exists
   - Avatar image exists
   - `uv` command available
   - `GEMINI_API_KEY` environment variable set
3. Added non-empty file validation after generation
4. Improved error messages with specific failure reasons
5. Fixed file permissions to standard 755

**Files Changed:**
- `news-feed/generate-image.sh` (rewritten with +28 lines, -3 lines)

**Validation:**
```bash
# Test run with real story
bash news-feed/generate-image.sh \
  "Test: AI agents can now trade autonomously" \
  "bots trading bots. this will end well." \
  /tmp/test-news-image.png
```
Result: ✅ Successfully generated 5.9MB PNG (2752x1536, 16:9 ratio)

**Impact:**
- News feed cron job will now generate images reliably instead of silently failing
- Clear error messages if dependencies are missing
- No more silent fallback to text-only posts

**Commit:** `3c31b9cb` - "fix(news-feed): correct Nano Banana Pro script path and add validation"

**Next Leverage Point:**
The `fetch.py` and `fetch-ethdaily.py` scripts share duplicate RSS parsing logic. Consider consolidating into a shared module with provider configs (Decrypt, ETH Daily) to reduce maintenance burden and enable adding new sources easily.
