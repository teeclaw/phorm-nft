# 2026-02-12

## ERC-8004 Agent ID Correction
- **Agent ID 14482 is the current active ID** ğŸ”’ PRIMARY (was never burned)
- **Agent ID 16919 was burned** â€” all references removed
- Updated IDENTITY.md, TOOLS.md, MEMORY.md to reflect 14482
- Added `AGENT0_AGENT_ID=8453:14482` to `~/.openclaw/.env`
- `final-8004-metadata.json` already had correct agentId: 14482

## openclaw-8004 Skill â€” Full Test Session

### Test Results (agents 16926, 16928 â€” both burned after testing)

**Register test (16926 â€” HTTP URL):**
- Minted successfully but metadata unreachable (dummy URL)
- `tokenURI` returned dead HTTP link â†’ no metadata for consumers
- Lesson: SDK doesn't validate URI before tx â€” gas wasted on dead links

**Register test (16928 â€” base64 data URI) âœ…:**
- Built JSON â†’ base64 encoded â†’ `data:application/json;base64,...`
- Metadata fully readable on-chain via `tokenURI()` â€” no external dependency
- This is the correct approach for fully on-chain registration

**Update test (16928) âœ…:**
- Read `tokenURI` via viem â†’ decoded base64 â†’ modified JSON (added image) â†’ re-encoded â†’ submitted
- Verified on-chain: image field present and correct
- Must set `agent.registrationFile.agentId` before `registerHTTP()` to trigger update (not new mint)

**Deactivate test (16928):**
- Setting `active: false` in raw JSON didn't work â€” SDK overrides with internal state
- Must call `agent.setActive(false)` before `registerHTTP()`

### SDK Gotchas Documented in SKILL.md
1. `addEndpoint()` doesn't exist â€” use `setMetadata()` for custom services
2. `addSkill()`/`addDomain()` strict OASF validation â€” pass `false` to skip
3. `loadAgent()` fails when URI unreachable â€” use `createAgent()` + `registrationFile.agentId` instead
4. SDK overrides `active` field â€” must use `agent.setActive()`, not raw JSON
5. SDK return object missing custom fields (e.g. `image`) â€” verify via raw `tokenURI()` read

### SKILL.md Status
- **Register section:** ğŸ”’ Locked (fully on-chain base64 data URI flow)
- **Update section:** ğŸ”’ Locked (readâ†’decodeâ†’modifyâ†’re-encodeâ†’submit flow)
- Rewritten around base64 data URI as default (no HTTP URLs)
- Example interaction rewritten with on-chain verification step
- Error handling table updated with all discovered issues

## Feedback Feature Tests
- **Self-feedback blocked:** Contract reverts "Self-feedback not allowed" â€” same wallet can't rate own agent
- **Cross-wallet works:** Successfully rated 8453:14428 (scores 85, 90) and 8453:16934 (scores 50, 100)
- **Auto-generated feedback:** Read on-chain metadata â†’ assess â†’ generate score + tags â†’ preview â†’ confirm
- **Manual feedback:** Interactive flow â€” ask agent ID, score, tags â†’ preview â†’ confirm
- **`getReputationSummary` quirk:** May return 0 immediately after submit, but data is on-chain (visible on BaseScan)

## Telegram Inline Buttons for SKILL.md
- Added interactive button menus for Telegram (inlineButtons capability)
- **Main menu:** Update, Search Feedback, Give Feedback, Transfer, View Profile, Register New, Close
- **Feedback sub-menu:** Auto Generate / Manual / Back
- **Register sub-menu:** Pre-filled / Manual / Dummy / Back
- **Confirmation buttons on ALL drafts:** Submit / Modify / Cancel / Back
- callback_data format: `8004:{action}` routes back as user message
- Falls back to text menu if channel doesn't support buttons

## SKILL.md Button UX (Final)
- 3-layer max: Main Menu â†’ Sub-menu â†’ Confirmation
- All sub-menus: Update (From On-chain/Manual), Search (My Agent/Other), Feedback (Auto/Manual), Register (Pre-filled/Manual/Dummy)
- Confirmation buttons on ALL drafts: [âœ… Submit] [âœï¸ Modify] [âŒ Cancel] [â¬…ï¸ Back]
- Every result/error screen has `8004:menu` back button â€” no dead-ends
- Text input always bypasses buttons (e.g. "update name to X" skips menus)
- Context-aware buttons on results: Search results offer "Give Feedback to This Agent", Feedback success offers "View Reputation"
- Special callbacks: `8004:feedback:to:{id}` and `8004:search:agent:{id}` for pre-filled flows
- `8004:save:identity` and `8004:update:identity` for IDENTITY.md management post-registration/update

## Burned Test Agents
- 16926 (HTTP URL test) â€” burned
- 16928 (base64 data URI test) â€” burned
- 16930 (full register test) â€” burned
- 16932 (PhantomBot Zeta) â€” burned

- 14499 (early mint, no metadata) â€” burned (deactivated first, then transferred to 0xdEaD)
  - Step 1 tx: 0xd2556eaf684b338d9d1ff6f1be0885aa8c562ad4ffb46246617261897965606e
  - Step 2 tx: 0x5348f49c49b256cea1f992c484520817faa2746b0e66b051115ee99c1d089f0f

## Multi-Agent Detection â€” Config-First Approach (DECIDED)
- `tokenOfOwnerByIndex` NOT supported by IdentityRegistry (reverts)
- Subgraph rejected: infra cost + complexity
- `ownerOf` enumeration rejected: wasteful RPC spam
- **Winner: Read agent IDs from TOOLS.md "Owned Agents:" list**
- `balanceOf` used only as sanity check (count mismatch warning)
- New agents appended to TOOLS.md at mint time from tx receipt
- Agent IDs are public on-chain data â€” belong in TOOLS.md, NOT .env
- Removed `AGENT0_AGENT_IDS` from .env (was briefly added, then removed)
- `AGENT0_AGENT_ID` stays in .env for primary agent only

## SKILL.md Rewrite: viem + ABI First (DECIDED)
- **User decision:** Force viem + ABI for all contract calls. SDK only if no ABI function available.
- Rewrote entire SKILL.md â€” all 30 contract calls now use direct viem
- Zero agent0-sdk dependency
- Key operations mapped:
  - Register: `writeContract('register', [dataURI])` + parse Transfer event for agentId
  - Update: `writeContract('setAgentURI', [id, dataURI])` â€” no more registrationFile.agentId hack
  - Transfer/Burn: `writeContract('transferFrom', [from, to, id])` â€” SDK broke on data URIs
  - Feedback: `writeContract('giveFeedback', [...])` direct
  - Search: `getClients()` â†’ `getSummary()` (empty clientAddresses array REVERTS)
  - Read: `readContract('tokenURI', [id])` â€” SDK loadAgent() broke on data URIs

## SDK Gotchas Discovered (viem migration)
- `sdk.transferAgent()` fails on data URI agents â€” tries to loadAgent() first, rejects data: URIs
- `getSummary()` reverts with "clientAddresses required" if passed empty array â€” must call `getClients()` first
- `readAllFeedback()` same â€” needs actual client addresses

## Burn Best Practice (DECIDED)
- Always set `active: false` before burning (setAgentURI with inactive metadata)
- Then transfer to 0x000000000000000000000000000000000000dEaD
- Two transactions, documented in SKILL.md Transfer section
- Transfer sub-menu now has [ğŸ”„ Transfer to Address] and [ğŸ”¥ Burn Agent] buttons

## Button Flow Test
- Agent picker â†’ select 14499 â†’ main menu â†’ Transfer/Burn â†’ Burn â†’ confirm â†’ executed âœ…
- Full inline button flow working end-to-end

## A2A Endpoint Notes
- `/agent-profile.json` is behind x402 paywall (returns 402 without payment)
- Local metadata file: `a2a-endpoint/final-8004-metadata.json` (has full registration data)
- Agent 14482 uses `data:application/json;base64,...` on-chain (correct approach)
